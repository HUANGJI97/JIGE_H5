{"remainingRequest":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js!/Users/lianfangti/Project/UNI-APP/JIGE/src/pages/user/user.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/src/pages/user/user.vue","mtime":1568272904248},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport Page from \"../component/page/page\";\nimport Modal from \"../component/modal\";\nimport { decodeParams } from \"../../utils/utils\"\nimport {\n    checkSignin,\n    getExtensionCode,\n    getExtensionUser, getMpConfig,\n    getNotice,\n    getUserInfo,\n    Login,\n    signin\n} from \"../../api/user\";\nimport cache from \"../../utils/cache\";\nexport default {\n    name: \"user\",\n    components: {Modal, Page},\n    data(){\n        return {\n            config:{},\n            modelKefu:false,\n            unreadNoticeCount:0,\n            modelEx:false,\n            exinfo:{},\n            userInfo:{},\n            exCode:null,\n            signInfo:{\n                signed:true\n            }\n        }\n    },\n\n   async onLoad(options){\n       console.log(`调试:获取到token`, options);\n        this.loadData();\n\n\n\n    },\n    created(options){\n        // console.log(`调试:create->options`, options)\n        this.loadData();\n    },\n    methods:{\n        async handleRefresh(){\n            console.log(`调试:触发刷新`,);\n            cache.del('exCode');\n            uni.showLoading({title:'获取中'});\n            await this.handleToEx()\n            uni.showToast({title:'刷新成功'});\n        },\n        async loadData(){\n            let token =  cache.get(\"token\");\n            // cache.set(\"token\",token);\n            uni.showLoading({\n                title:'loading',\n            })\n            let tokens = cache.get(\"tokens\");\n            let xToken = cache.get(\"X-Token\");\n            if(xToken){\n                try {\n                    let { access_token,openid } = tokens;\n                    this.userInfo  = await getUserInfo({access_token,token,openid});\n                    let config = await getMpConfig();\n                    this.config= config;\n                    console.log(`调试:获取到系统配置`, config);\n\n\n                        this.signInfo = await  checkSignin();\n                    console.log(`调试:获取到的签到信息`, this.signInfo);\n\n                    this.exinfo = await  getExtensionUser({page:1,size:5});\n                    // this.exinfo =exinfo\n                    // console.log(`调试:获取到推广用户信息`, exinfo)\n                    uni.hideLoading();\n\n                    let notice = await  getNotice({status:0});\n                    this.unreadNoticeCount = notice.list.length;\n                    console.log(`调试:获取到通知信息`, notice)\n\n                }catch (e) {\n                    console.log(`调试:出错`, e);\n                    uni.hideLoading();\n                }\n            }else{\n                console.log(`调试:没有Xtoken 重新调用登录`);\n                Login({token})\n            }\n\n        },\n        handleToRecharge(){\n            uni.navigateTo({\n                url:'../recharge/recharge'\n            })\n        },\n        handleToRechargeRecord(){\n            uni.navigateTo({\n                url:'../rechargeRecord/rechargeRecord'\n            })\n        },\n        handleToExRecord(){\n            uni.navigateTo({\n                url:'../consumeRecord/consumeRecord'\n            })\n        },\n        handleToRankingList(){\n            uni.navigateTo({\n                url:'../rankingList/rankingList'\n            })\n        },\n        async handleToEx(){\n            uni.showLoading({title:'获取中'});\n          let res = await getExtensionCode().catch(res=>{\n              uni.hideLoading();\n          });\n          uni.hideLoading();\n          this.modelEx = true;\n          this.exCode =res;\n          return  true;\n        },\n        handleToMessage(){\n            // uni.showToast({title:'Developing...',icon:'none'});\n            // return 0;\n          uni.navigateTo({\n              url:'./message'\n          })\n        },\n        async handleSign(){\n             if(!this.signInfo.signed){\n                  try {\n                      uni.showLoading({title:'签到中'});\n                       let result = await  signin();\n                       uni.hideLoading();\n                       this.loadData();\n                       uni.showModal({\n                           title:'签到成功',\n                           content:`您已成功签到 粮票+${result.addCoin}`,\n                           showCancel:false\n                       });\n                       console.log(`调试:签到返回值`,result)\n                  }catch ({error}) {\n                      uni.hideLoading();\n                      uni.showToast({\n                          title:error.msg || '签到失败',\n                          icon:'none'\n                      })\n                  }\n             }\n        }\n    }\n}\n",{"version":3,"sources":["user.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"user.vue","sourceRoot":"src/pages/user","sourcesContent":["<template>\n<page hide-title-bar=\"\"  bg-color=\"#f2f7fa\">\n    <view class=\"header flex justify-center \">\n        <view class=\"flex justify-end  padding\" style=\"position: fixed;top: 0; width: 100vw;\">\n            <view class=\"cuIcon cuIcon-rankfill text-white padding-xs\" style=\"position: relative;font-size: 50rpx;\" @tap=\"handleToRankingList\">\n            </view>\n            <view class=\"cuIcon cuIcon-message text-white padding-xs\" style=\"position: relative;font-weight:10;font-size: 50rpx;\" @tap=\"handleToMessage\">\n                <view class=\"cu-tag badge\" v-if=\"unreadNoticeCount\">{{unreadNoticeCount}} </view>\n            </view>\n        </view>\n        <view class=\"bg-avatar shadow shadow-blur padding\">\n            <view class=\"flex justify-between margin-top-xs\">\n               <view>\n                   <view class=\"flex align-center\">\n                       <view class=\"sm cu-avatar round\" :style=\"'background-image: url('+userInfo.headimgurl+')'\"></view>\n                       <view class=\"margin-left-sm\">{{userInfo.nickname}}</view>\n                   </view>\n                   <view>\n                       <view class=\"flex align-end\">\n                           <view class=\"bg-cash margin-bottom-xs\"></view>\n                           <view class=\"text-blance margin-left-sm\">{{userInfo.times}}</view>\n                       </view>\n                       <view class=\"text-sm text-gray margin-top-xs\" @click=\"handleToRechargeRecord\">\n                           充值记录\n                           <text class=\"cuIcon-right\"></text>\n                       </view>\n                   </view>\n               </view>\n                <view class=\" flex align-center \">\n                    <button class=\"cu-btn bg-blue round\" @click=\"handleToRecharge\">\n                        粮票充值\n                    </button>\n                </view>\n            </view>\n        </view>\n    </view>\n    <view class=\"margin-top-xl padding \" style=\"margin-top: 100rpx;height: 66vh;overflow-y: scroll;padding-bottom: 0px;\">\n            <view class=\"text-bold\">免费获取更多粮票</view>\n\n            <view class=\"flex justify-between bg-white padding radius margin-top align-center\">\n                <view class=\"flex align-center\">\n                    <view class=\"text-center\">\n                        <view class=\"text-xxl text-black text-bold\">+{{config.ex_coin}}</view>\n                        <view class=\"bg-cash-sm margin-top-xs\" ></view>\n                    </view>\n                    <view class=\"margin-left\">\n                        <view class=\"text-black text-md\">邀请好友</view>\n                        <view class=\"text-sm text-gray\" style=\"max-width: 350rpx;\">每邀请1名好友,即可获得8张粮票奖励</view>\n                        <view class=\"margin-top-xs flex\">\n                            <view class=\"cu-avatar-group\">\n                                <view v-for=\"(item,index) in exinfo.list\" :key=\"index\" class=\"cu-avatar round sm\" :style=\"'background-image: url('+item.headimgurl+')'\"></view>\n                            </view>\n                            <view class=\"text-sm text-blue margin-top-xs\" @click=\"handleToExRecord\">\n                                已邀请{{exinfo.total}}人\n                                <text class=\"cuIcon-right\"></text>\n                            </view>\n                        </view>\n                    </view>\n                </view>\n                <view>\n                    <button class=\"cu-btn sm bg-blue round\" @click=\"handleToEx\">\n                        去邀请\n                    </button>\n                </view>\n            </view>\n\n\n            <view class=\"flex justify-between bg-white padding radius margin-top align-center\" v-if=\"false\">\n                <view class=\"flex align-center\">\n                    <view class=\"text-center\">\n                        <view class=\"text-xl text-black text-bold\">+N</view>\n                        <view class=\"bg-cash-sm margin-top-xs\" ></view>\n                    </view>\n                    <view class=\"margin-left\">\n                        <view class=\"text-black text-md\">每周打榜</view>\n                        <view class=\"text-sm text-gray\" style=\"max-width: 350rpx;\">每周打榜</view>\n                    </view>\n                </view>\n                <view>\n                    <button class=\"cu-btn sm bg-blue round\" @click=\"handleToRankingList\" >\n                        去打榜\n                    </button>\n                </view>\n            </view>\n\n            <view class=\"flex justify-between bg-white padding radius margin-top align-center\">\n                <view class=\"flex align-center\">\n                    <view class=\"text-center\">\n                        <view class=\"text-xxl text-black text-bold\">+{{config.sign_coin}}</view>\n                        <view class=\"bg-cash-sm margin-top-xs\" ></view>\n                    </view>\n                    <view class=\"margin-left\">\n                        <view class=\"text-black text-md\">每日签到</view>\n                        <view class=\"text-sm text-gray\" style=\"max-width: 350rpx;\">每日签到，每日签到可获取2粮票</view>\n                    </view>\n                </view>\n                <view>\n                    <button class=\"cu-btn sm bg-blue round\" :disabled=\"signInfo.signed\" @click=\"handleSign\">\n                        {{signInfo.signed?'已签到':'去签到'}}\n                    </button>\n                </view>\n            </view>\n\n\n            <view class=\"flex justify-between bg-white padding radius margin-top align-center\" >\n                <view class=\"flex align-center\">\n                    <view class=\"text-center\">\n                        <view class=\"text-xl text-black text-bold\">+{{config.add_coin}}</view>\n                        <view class=\"bg-cash-sm margin-top-xs\" ></view>\n                    </view>\n                    <view class=\"margin-left\">\n                        <view class=\"text-black text-md\">添加客服微信</view>\n                        <view class=\"text-sm text-gray\" style=\"max-width: 350rpx;\">添加客服为好友,可额外获得20枚粮票奖励</view>\n                    </view>\n                </view>\n                <view>\n                    <button :disabled=\"userInfo.added\" class=\"cu-btn sm bg-blue round\" @click=\"modelKefu = true\">\n                        {{userInfo.added?'已完成':'去完成'}}\n                    </button>\n                </view>\n            </view>\n\n\n\n\n    </view>\n\n\n    <view v-if=\"modelKefu\" class=\"drawer-modal-mask\"></view>\n    <view v-if=\"modelKefu\" class=\"drawer-modal\">\n        <view class=\"drawer-modal-button flex justify-end\">\n            <view class=\"cuIcon-close text-white text-xl margin-right margin-bottom\" @click=\"modelKefu = false\"></view>\n        </view>\n       <view class=\"drawer-modal-content bg-white padding \">\n            <view class=\"text-center margin-bottom\">\n                <view class=\"margin-top\">长按识别下方二维码</view>\n                <view>添加客服微信号，即可领取奖励</view>\n                <image class=\"margin-top\" src=\"../../static/kefu.png\" style=\"height: 400rpx;width: 400rpx;\"></image>\n            </view>\n       </view>\n    </view>\n\n     <modal v-model=\"modelEx\" hide-footer hide-header bg-color=\"none\"  @onRefresh=\"handleRefresh\" >\n        <img :src=\"exCode || `../../static/hongbao.png`\" style=\"width: 100%;\" class=\"radius-xl\"/>\n        <view class=\"bg-white round padding-xs margin-top-xs \" style=\"\">长按分享图片给好友或者保存吧</view>\n     </modal>\n\n</page>\n\n</template>\n\n<script>\n    import Page from \"../component/page/page\";\n    import Modal from \"../component/modal\";\n    import { decodeParams } from \"../../utils/utils\"\n    import {\n        checkSignin,\n        getExtensionCode,\n        getExtensionUser, getMpConfig,\n        getNotice,\n        getUserInfo,\n        Login,\n        signin\n    } from \"../../api/user\";\n    import cache from \"../../utils/cache\";\n    export default {\n        name: \"user\",\n        components: {Modal, Page},\n        data(){\n            return {\n                config:{},\n                modelKefu:false,\n                unreadNoticeCount:0,\n                modelEx:false,\n                exinfo:{},\n                userInfo:{},\n                exCode:null,\n                signInfo:{\n                    signed:true\n                }\n            }\n        },\n\n       async onLoad(options){\n           console.log(`调试:获取到token`, options);\n            this.loadData();\n\n\n\n        },\n        created(options){\n            // console.log(`调试:create->options`, options)\n            this.loadData();\n        },\n        methods:{\n            async handleRefresh(){\n                console.log(`调试:触发刷新`,);\n                cache.del('exCode');\n                uni.showLoading({title:'获取中'});\n                await this.handleToEx()\n                uni.showToast({title:'刷新成功'});\n            },\n            async loadData(){\n                let token =  cache.get(\"token\");\n                // cache.set(\"token\",token);\n                uni.showLoading({\n                    title:'loading',\n                })\n                let tokens = cache.get(\"tokens\");\n                let xToken = cache.get(\"X-Token\");\n                if(xToken){\n                    try {\n                        let { access_token,openid } = tokens;\n                        this.userInfo  = await getUserInfo({access_token,token,openid});\n                        let config = await getMpConfig();\n                        this.config= config;\n                        console.log(`调试:获取到系统配置`, config);\n\n\n                            this.signInfo = await  checkSignin();\n                        console.log(`调试:获取到的签到信息`, this.signInfo);\n\n                        this.exinfo = await  getExtensionUser({page:1,size:5});\n                        // this.exinfo =exinfo\n                        // console.log(`调试:获取到推广用户信息`, exinfo)\n                        uni.hideLoading();\n\n                        let notice = await  getNotice({status:0});\n                        this.unreadNoticeCount = notice.list.length;\n                        console.log(`调试:获取到通知信息`, notice)\n\n                    }catch (e) {\n                        console.log(`调试:出错`, e);\n                        uni.hideLoading();\n                    }\n                }else{\n                    console.log(`调试:没有Xtoken 重新调用登录`);\n                    Login({token})\n                }\n\n            },\n            handleToRecharge(){\n                uni.navigateTo({\n                    url:'../recharge/recharge'\n                })\n            },\n            handleToRechargeRecord(){\n                uni.navigateTo({\n                    url:'../rechargeRecord/rechargeRecord'\n                })\n            },\n            handleToExRecord(){\n                uni.navigateTo({\n                    url:'../consumeRecord/consumeRecord'\n                })\n            },\n            handleToRankingList(){\n                uni.navigateTo({\n                    url:'../rankingList/rankingList'\n                })\n            },\n            async handleToEx(){\n                uni.showLoading({title:'获取中'});\n              let res = await getExtensionCode().catch(res=>{\n                  uni.hideLoading();\n              });\n              uni.hideLoading();\n              this.modelEx = true;\n              this.exCode =res;\n              return  true;\n            },\n            handleToMessage(){\n                // uni.showToast({title:'Developing...',icon:'none'});\n                // return 0;\n              uni.navigateTo({\n                  url:'./message'\n              })\n            },\n            async handleSign(){\n                 if(!this.signInfo.signed){\n                      try {\n                          uni.showLoading({title:'签到中'});\n                           let result = await  signin();\n                           uni.hideLoading();\n                           this.loadData();\n                           uni.showModal({\n                               title:'签到成功',\n                               content:`您已成功签到 粮票+${result.addCoin}`,\n                               showCancel:false\n                           });\n                           console.log(`调试:签到返回值`,result)\n                      }catch ({error}) {\n                          uni.hideLoading();\n                          uni.showToast({\n                              title:error.msg || '签到失败',\n                              icon:'none'\n                          })\n                      }\n                 }\n            }\n        }\n    }\n</script>\n\n<style scoped scoped>\n.header{\n    width: 100%;\n    height: 320rpx;\n    background-image: url(\"https://lft-ad.oss-cn-hangzhou.aliyuncs.com/eleme/png/bg_head.png\");\n    background-size: 100% 100%;\n}\n    .bg-avatar{\n        width: 90%;\n        height: 230rpx;\n        background: white;\n        position: relative;\n        background-image: url(\"../../static/bg_info.png\");\n        background-size: 100% 100%;\n        top: 180rpx;\n        box-shadow: 1px 1px 3px #022b777d;\n        border-radius: 10px;\n\n    }\n    .bg-cash{\n        background-image: url(\"../../static/cash_yellow.png\");\n        background-size: 100% 100%;\n        width: 80rpx;\n        height: 45rpx;\n    }\n    .bg-cash-sm{\n        background-image: url(\"../../static/cash_yellow.png\");\n        background-size: 100% 100%;\n        width: 60rpx;\n        height: 35rpx;\n        display: inline-block;\n    }\n    .text-blance{\n        color: black;\n        font-weight: bold;\n        font-size: 60rpx;\n\n    }\n/*    底部抽屉*/\n    .drawer-modal{\n        /*background: white;*/\n        position:absolute;\n        z-index: 99;\n        bottom: 0px;\n        width: 100%;\n    }\n    .drawer-modal-mask{\n        background-color:rgba(0,0,0,0.7);\n        width: 100vw;\n        height: 100vh;\n        position: fixed;\n        z-index: 98;\n        top: 0;\n    }\n    .drawer-modal-content{\n        border-top-left-radius: 50rpx;\n        border-top-right-radius: 50rpx;\n    }\n</style>\n"]}]}