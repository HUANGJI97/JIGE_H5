{"remainingRequest":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-2!/Users/lianfangti/Project/UNI-APP/JIGE/src/utils/request.js","dependencies":[{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/src/utils/request.js","mtime":1568253164345},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.request = void 0;\n\nvar _vue = _interopRequireDefault(require(\"vue\"));\n\nvar _HttpRequest = _interopRequireDefault(require(\"./HttpRequest\"));\n\nvar _cache = _interopRequireDefault(require(\"./cache\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nvar ENV = _vue.default.prototype.ENV;\nvar ENV_MAP = {\n  'prod': 'http://eleme.lianfangti.cn',\n  'dev': 'https://api.easy.echosite.cn'\n};\nvar request = new _HttpRequest.default();\nexports.request = request;\nrequest.setConfig(function (config) {\n  /* 设置全局配置 */\n  config.baseUrl = ENV_MAP[ENV];\n  return config;\n});\nrequest.interceptor.request(function (config, cancel) {\n  /* 请求之前拦截器 */\n  config.header = _objectSpread({}, config.header, {\n    \"token\": _cache.default.get('token') || '',\n    \"X-Token\": _cache.default.get(\"X-Token\") || '' // console.log(`调试:请求拦截器`, config);\n\n  });\n  return config;\n});\nrequest.interceptor.response(function (response) {\n  /* 请求之后拦截器 */\n  // console.log(`调试:响应拦截器`, response);kin's\n  if (response.data.code !== 0) {\n    var from = \"\".concat(response.config.method, \" \").concat(response.config.url.replace(response.config.base, \"\"));\n\n    if (response.data.code === 400) {\n      // Token 失效\n      window.location.href = window.location.protocol + \"//\" + window.location.host;\n    }\n\n    if (response.data.code === 403) {\n      // Token 失效\n      _cache.default.del(\"X-Token\");\n\n      var href = window.location.protocol + \"//\" + window.location.host + '/' + window.location.search;\n      console.log(\"\\u8C03\\u8BD5:\\u8981\\u8DF3\\u8F6C\\u7684\", href, window.location);\n      window.location.href = href;\n    }\n\n    return Promise.reject({\n      from: from,\n      error: response.data || response.data\n    });\n  }\n\n  return response.data;\n});",{"version":3,"sources":["/Users/lianfangti/Project/UNI-APP/JIGE/src/utils/request.js"],"names":["ENV","Vue","prototype","ENV_MAP","request","Request","setConfig","config","baseUrl","interceptor","cancel","header","cache","get","response","data","code","from","method","url","replace","base","window","location","href","protocol","host","del","search","console","log","Promise","reject","error"],"mappings":";;;;;;;AACA;;AAEA;;AACA;;;;;;;;AACA,IAAMA,GAAG,GAAGC,aAAIC,SAAJ,CAAcF,GAA1B;AACA,IAAMG,OAAO,GAAG;AACZ,UAAO,4BADK;AAEZ,SAAM;AAFM,CAAhB;AAKA,IAAMC,OAAO,GAAG,IAAIC,oBAAJ,EAAhB;;AACAD,OAAO,CAACE,SAAR,CAAkB,UAACC,MAAD,EAAY;AAAE;AAC5BA,EAAAA,MAAM,CAACC,OAAP,GAAgBL,OAAO,CAACH,GAAD,CAAvB;AACA,SAAOO,MAAP;AACH,CAHD;AAIAH,OAAO,CAACK,WAAR,CAAoBL,OAApB,CAA4B,UAACG,MAAD,EAASG,MAAT,EAAoB;AAAE;AAC9CH,EAAAA,MAAM,CAACI,MAAP,qBACOJ,MAAM,CAACI,MADd;AAEI,aAAQC,eAAMC,GAAN,CAAU,OAAV,KAAsB,EAFlC;AAGI,eAAUD,eAAMC,GAAN,CAAU,SAAV,KAAwB,EAHtC,CAKA;;AALA;AAMA,SAAON,MAAP;AACH,CARD;AASAH,OAAO,CAACK,WAAR,CAAoBK,QAApB,CAA6B,UAACA,QAAD,EAAc;AAAE;AACzC;AACA,MAAGA,QAAQ,CAACC,IAAT,CAAcC,IAAd,KAAsB,CAAzB,EAA4B;AACxB,QAAIC,IAAI,aAAMH,QAAQ,CAACP,MAAT,CAAgBW,MAAtB,cAAgCJ,QAAQ,CAACP,MAAT,CAAgBY,GAAhB,CAAoBC,OAApB,CAA4BN,QAAQ,CAACP,MAAT,CAAgBc,IAA5C,EAAiD,EAAjD,CAAhC,CAAR;;AACA,QAAGP,QAAQ,CAACC,IAAT,CAAcC,IAAd,KAAuB,GAA1B,EAA8B;AAAE;AAC5BM,MAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAsBF,MAAM,CAACC,QAAP,CAAgBE,QAAhB,GAA2B,IAA3B,GAAkCH,MAAM,CAACC,QAAP,CAAgBG,IAAxE;AACH;;AACD,QAAGZ,QAAQ,CAACC,IAAT,CAAcC,IAAd,KAAuB,GAA1B,EAA8B;AAAE;AAC5BJ,qBAAMe,GAAN,CAAU,SAAV;;AACD,UAAIH,IAAI,GAAEF,MAAM,CAACC,QAAP,CAAgBE,QAAhB,GAA2B,IAA3B,GAAkCH,MAAM,CAACC,QAAP,CAAgBG,IAAlD,GAAuD,GAAvD,GAA2DJ,MAAM,CAACC,QAAP,CAAgBK,MAArF;AACCC,MAAAA,OAAO,CAACC,GAAR,0CAAuBN,IAAvB,EAA4BF,MAAM,CAACC,QAAnC;AACAD,MAAAA,MAAM,CAACC,QAAP,CAAgBC,IAAhB,GAAsBA,IAAtB;AACH;;AAED,WAAOO,OAAO,CAACC,MAAR,CAAe;AAACf,MAAAA,IAAI,EAAJA,IAAD;AAAMgB,MAAAA,KAAK,EAACnB,QAAQ,CAACC,IAAT,IAAiBD,QAAQ,CAACC;AAAtC,KAAf,CAAP;AACH;;AACD,SAAOD,QAAQ,CAACC,IAAhB;AACH,CAjBD","sourcesContent":["\nimport Vue from 'vue'\n\nimport Request from './HttpRequest'\nimport cache from \"./cache\"\nconst ENV = Vue.prototype.ENV;\nconst ENV_MAP = {\n    'prod':'http://eleme.lianfangti.cn',\n    'dev':'https://api.easy.echosite.cn',\n}\n\nconst request = new Request();\nrequest.setConfig((config) => { /* 设置全局配置 */\n    config.baseUrl =ENV_MAP[ENV];\n    return config\n})\nrequest.interceptor.request((config, cancel) => { /* 请求之前拦截器 */\n    config.header = {\n        ...config.header,\n        \"token\":cache.get('token') || '',\n        \"X-Token\":cache.get(\"X-Token\") || ''\n    }\n    // console.log(`调试:请求拦截器`, config);\n    return config;\n})\nrequest.interceptor.response((response) => { /* 请求之后拦截器 */\n    // console.log(`调试:响应拦截器`, response);kin's\n    if(response.data.code !==0 ){\n        let from = `${response.config.method} ${response.config.url.replace(response.config.base,\"\")}`;\n        if(response.data.code === 400){ // Token 失效\n            window.location.href =window.location.protocol + \"//\" + window.location.host\n        }\n        if(response.data.code === 403){ // Token 失效\n            cache.del(\"X-Token\");\n           let href= window.location.protocol + \"//\" + window.location.host+'/'+window.location.search;\n            console.log(`调试:要跳转的`, href,window.location)\n            window.location.href =href\n        }\n\n        return Promise.reject({from,error:response.data || response.data})\n    }\n    return response.data;\n})\n\n\nexport {\n    request\n};\n\n\n"]}]}