{"remainingRequest":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/thread-loader/dist/cjs.js!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-3!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js!/Users/lianfangti/Project/UNI-APP/JIGE/src/pages/user/user.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/src/pages/user/user.vue","mtime":1568216119888},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@babel/runtime/regenerator\"));\n\nvar _page = _interopRequireDefault(require(\"../component/page/page\"));\n\nvar _modal = _interopRequireDefault(require(\"../component/modal\"));\n\nvar _utils = require(\"../../utils/utils\");\n\nvar _user = require(\"../../api/user\");\n\nvar _cache = _interopRequireDefault(require(\"../../utils/cache\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nvar _default = {\n  name: \"user\",\n  components: {\n    Modal: _modal.default,\n    Page: _page.default\n  },\n  data: function data() {\n    return {\n      modelKefu: false,\n      unreadNoticeCount: 0,\n      modelEx: false,\n      exinfo: {},\n      userInfo: {},\n      exCode: null,\n      signInfo: {\n        signed: true\n      }\n    };\n  },\n  onLoad: function () {\n    var _onLoad = _asyncToGenerator(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee(options) {\n      return _regenerator.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              console.log(\"\\u8C03\\u8BD5:\\u83B7\\u53D6\\u5230token\", options);\n              this.loadData();\n\n            case 2:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this);\n    }));\n\n    function onLoad(_x) {\n      return _onLoad.apply(this, arguments);\n    }\n\n    return onLoad;\n  }(),\n  created: function created(options) {\n    // console.log(`调试:create->options`, options)\n    this.loadData();\n  },\n  methods: {\n    handleRefresh: function () {\n      var _handleRefresh = _asyncToGenerator(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee2() {\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                console.log(\"\\u8C03\\u8BD5:\\u89E6\\u53D1\\u5237\\u65B0\");\n\n                _cache.default.del('exCode');\n\n                uni.showLoading({\n                  title: '获取中'\n                });\n                _context2.next = 5;\n                return this.handleToEx();\n\n              case 5:\n                uni.showToast({\n                  title: '刷新成功'\n                });\n\n              case 6:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function handleRefresh() {\n        return _handleRefresh.apply(this, arguments);\n      }\n\n      return handleRefresh;\n    }(),\n    loadData: function () {\n      var _loadData = _asyncToGenerator(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee3() {\n        var token, tokens, xToken, access_token, openid, notice;\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                token = _cache.default.get(\"token\"); // cache.set(\"token\",token);\n\n                uni.showLoading({\n                  title: 'loading'\n                });\n                tokens = _cache.default.get(\"tokens\");\n                xToken = _cache.default.get(\"X-Token\");\n\n                if (!xToken) {\n                  _context3.next = 31;\n                  break;\n                }\n\n                _context3.prev = 5;\n                access_token = tokens.access_token, openid = tokens.openid;\n                _context3.next = 9;\n                return (0, _user.getUserInfo)({\n                  access_token: access_token,\n                  token: token,\n                  openid: openid\n                });\n\n              case 9:\n                this.userInfo = _context3.sent;\n                _context3.next = 12;\n                return (0, _user.checkSignin)();\n\n              case 12:\n                this.signInfo = _context3.sent;\n                console.log(\"\\u8C03\\u8BD5:\\u83B7\\u53D6\\u5230\\u7684\\u7B7E\\u5230\\u4FE1\\u606F\", this.signInfo);\n                _context3.next = 16;\n                return (0, _user.getExtensionUser)({\n                  page: 1,\n                  size: 5\n                });\n\n              case 16:\n                this.exinfo = _context3.sent;\n                // this.exinfo =exinfo\n                // console.log(`调试:获取到推广用户信息`, exinfo)\n                uni.hideLoading();\n                _context3.next = 20;\n                return (0, _user.getNotice)({\n                  status: 0\n                });\n\n              case 20:\n                notice = _context3.sent;\n                this.unreadNoticeCount = notice.list.length;\n                console.log(\"\\u8C03\\u8BD5:\\u83B7\\u53D6\\u5230\\u901A\\u77E5\\u4FE1\\u606F\", notice);\n                _context3.next = 29;\n                break;\n\n              case 25:\n                _context3.prev = 25;\n                _context3.t0 = _context3[\"catch\"](5);\n                console.log(\"\\u8C03\\u8BD5:\\u51FA\\u9519\", _context3.t0);\n                uni.hideLoading();\n\n              case 29:\n                _context3.next = 33;\n                break;\n\n              case 31:\n                console.log(\"\\u8C03\\u8BD5:\\u6CA1\\u6709Xtoken \\u91CD\\u65B0\\u8C03\\u7528\\u767B\\u5F55\");\n                (0, _user.Login)({\n                  token: token\n                });\n\n              case 33:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[5, 25]]);\n      }));\n\n      function loadData() {\n        return _loadData.apply(this, arguments);\n      }\n\n      return loadData;\n    }(),\n    handleToRecharge: function handleToRecharge() {\n      uni.navigateTo({\n        url: '../recharge/recharge'\n      });\n    },\n    handleToRechargeRecord: function handleToRechargeRecord() {\n      uni.navigateTo({\n        url: '../rechargeRecord/rechargeRecord'\n      });\n    },\n    handleToExRecord: function handleToExRecord() {\n      uni.navigateTo({\n        url: '../consumeRecord/consumeRecord'\n      });\n    },\n    handleToRankingList: function handleToRankingList() {\n      uni.navigateTo({\n        url: '../rankingList/rankingList'\n      });\n    },\n    handleToEx: function () {\n      var _handleToEx = _asyncToGenerator(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee4() {\n        var res;\n        return _regenerator.default.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                uni.showLoading({\n                  title: '获取中'\n                });\n                _context4.next = 3;\n                return (0, _user.getExtensionCode)().catch(function (res) {\n                  uni.hideLoading();\n                });\n\n              case 3:\n                res = _context4.sent;\n                uni.hideLoading();\n                this.modelEx = true;\n                this.exCode = res;\n                return _context4.abrupt(\"return\", true);\n\n              case 8:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function handleToEx() {\n        return _handleToEx.apply(this, arguments);\n      }\n\n      return handleToEx;\n    }(),\n    handleToMessage: function handleToMessage() {\n      // uni.showToast({title:'Developing...',icon:'none'});\n      // return 0;\n      uni.navigateTo({\n        url: './message'\n      });\n    },\n    handleSign: function () {\n      var _handleSign = _asyncToGenerator(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee5() {\n        var result, error;\n        return _regenerator.default.wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                if (this.signInfo.signed) {\n                  _context5.next = 17;\n                  break;\n                }\n\n                _context5.prev = 1;\n                uni.showLoading({\n                  title: '签到中'\n                });\n                _context5.next = 5;\n                return (0, _user.signin)();\n\n              case 5:\n                result = _context5.sent;\n                uni.hideLoading();\n                this.loadData();\n                uni.showModal({\n                  title: '签到成功',\n                  content: \"\\u60A8\\u5DF2\\u6210\\u529F\\u7B7E\\u5230 \\u7CAE\\u7968+\".concat(result.addCoin),\n                  showCancel: false\n                });\n                console.log(\"\\u8C03\\u8BD5:\\u7B7E\\u5230\\u8FD4\\u56DE\\u503C\", result);\n                _context5.next = 17;\n                break;\n\n              case 12:\n                _context5.prev = 12;\n                _context5.t0 = _context5[\"catch\"](1);\n                error = _context5.t0.error;\n                uni.hideLoading();\n                uni.showToast({\n                  title: error.msg || '签到失败',\n                  icon: 'none'\n                });\n\n              case 17:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[1, 12]]);\n      }));\n\n      function handleSign() {\n        return _handleSign.apply(this, arguments);\n      }\n\n      return handleSign;\n    }()\n  }\n};\nexports.default = _default;",{"version":3,"sources":["user.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n<page hide-title-bar=\"\"  bg-color=\"#f2f7fa\">\n    <view class=\"header flex justify-center \">\n        <view class=\"flex justify-end  padding\" style=\"position: fixed;top: 0; width: 100vw;\">\n\n            <view class=\"cuIcon cuIcon-message text-white padding-xs\" style=\"position: relative;font-size: 50rpx;\" @tap=\"handleToMessage\">\n                <view class=\"cu-tag badge\" v-if=\"unreadNoticeCount\">{{unreadNoticeCount}} </view>\n            </view>\n        </view>\n        <view class=\"bg-avatar shadow shadow-blur padding\">\n            <view class=\"flex justify-between margin-top-xs\">\n               <view>\n                   <view class=\"flex align-center\">\n                       <view class=\"sm cu-avatar round\" :style=\"'background-image: url('+userInfo.headimgurl+')'\"></view>\n                       <view class=\"margin-left-sm\">{{userInfo.nickname}}</view>\n                   </view>\n                   <view>\n                       <view class=\"flex align-end\">\n                           <view class=\"bg-cash margin-bottom-xs\"></view>\n                           <view class=\"text-blance margin-left-sm\">{{userInfo.times}}</view>\n                       </view>\n                       <view class=\"text-sm text-gray margin-top-xs\" @click=\"handleToRechargeRecord\">\n                           充值记录\n                           <text class=\"cuIcon-right\"></text>\n                       </view>\n                   </view>\n               </view>\n                <view class=\" flex align-center \">\n                    <button class=\"cu-btn bg-blue round\" @click=\"handleToRecharge\">\n                        粮票充值\n                    </button>\n                </view>\n            </view>\n        </view>\n    </view>\n    <view class=\"margin-top-xl padding \" style=\"margin-top: 100rpx;height: 66vh;overflow-y: scroll;padding-bottom: 0px;\">\n            <view class=\"text-bold\">免费获取更多粮票</view>\n\n            <view class=\"flex justify-between bg-white padding radius margin-top align-center\">\n                <view class=\"flex align-center\">\n                    <view class=\"text-center\">\n                        <view class=\"text-xxl text-black text-bold\">+8</view>\n                        <view class=\"bg-cash-sm margin-top-xs\" ></view>\n                    </view>\n                    <view class=\"margin-left\">\n                        <view class=\"text-black text-md\">邀请好友</view>\n                        <view class=\"text-sm text-gray\" style=\"max-width: 350rpx;\">每邀请1名好友,即可获得8张粮票奖励</view>\n                        <view class=\"margin-top-xs flex\">\n                            <view class=\"cu-avatar-group\">\n                                <view v-for=\"(item,index) in exinfo.list\" class=\"cu-avatar round sm\" :style=\"'background-image: url('+item.headimgurl+')'\"></view>\n                            </view>\n                            <view class=\"text-sm text-blue margin-top-xs\" @click=\"handleToExRecord\">\n                                已邀请{{exinfo.total}}人\n                                <text class=\"cuIcon-right\"></text>\n                            </view>\n                        </view>\n                    </view>\n                </view>\n                <view>\n                    <button class=\"cu-btn sm bg-blue round\" @click=\"handleToEx\">\n                        去邀请\n                    </button>\n                </view>\n            </view>\n\n\n            <view class=\"flex justify-between bg-white padding radius margin-top align-center\">\n                <view class=\"flex align-center\">\n                    <view class=\"text-center\">\n                        <view class=\"text-xl text-black text-bold\">+N</view>\n                        <view class=\"bg-cash-sm margin-top-xs\" ></view>\n                    </view>\n                    <view class=\"margin-left\">\n                        <view class=\"text-black text-md\">每周打榜</view>\n                        <view class=\"text-sm text-gray\" style=\"max-width: 350rpx;\">每周打榜</view>\n                    </view>\n                </view>\n                <view>\n                    <button class=\"cu-btn sm bg-blue round\" @click=\"handleToRankingList\" >\n                        去打榜\n                    </button>\n                </view>\n            </view>\n\n            <view class=\"flex justify-between bg-white padding radius margin-top align-center\">\n                <view class=\"flex align-center\">\n                    <view class=\"text-center\">\n                        <view class=\"text-xxl text-black text-bold\">+2</view>\n                        <view class=\"bg-cash-sm margin-top-xs\" ></view>\n                    </view>\n                    <view class=\"margin-left\">\n                        <view class=\"text-black text-md\">每日签到</view>\n                        <view class=\"text-sm text-gray\" style=\"max-width: 350rpx;\">每日签到，每日签到可获取2粮票</view>\n                    </view>\n                </view>\n                <view>\n                    <button class=\"cu-btn sm bg-blue round\" :disabled=\"signInfo.signed\" @click=\"handleSign\">\n                        {{signInfo.signed?'已签到':'去签到'}}\n                    </button>\n                </view>\n            </view>\n\n\n            <view class=\"flex justify-between bg-white padding radius margin-top align-center\" >\n                <view class=\"flex align-center\">\n                    <view class=\"text-center\">\n                        <view class=\"text-xl text-black text-bold\">+20</view>\n                        <view class=\"bg-cash-sm margin-top-xs\" ></view>\n                    </view>\n                    <view class=\"margin-left\">\n                        <view class=\"text-black text-md\">添加客服微信</view>\n                        <view class=\"text-sm text-gray\" style=\"max-width: 350rpx;\">添加客服为好友,可额外获得20枚粮票奖励</view>\n                    </view>\n                </view>\n                <view>\n                    <button :disabled=\"userInfo.added\" class=\"cu-btn sm bg-blue round\" @click=\"modelKefu = true\">\n                        {{userInfo.added?'已完成':'去完成'}}\n                    </button>\n                </view>\n            </view>\n\n\n\n\n    </view>\n\n\n    <view v-if=\"modelKefu\" class=\"drawer-modal-mask\"></view>\n    <view v-if=\"modelKefu\" class=\"drawer-modal\">\n        <view class=\"drawer-modal-button flex justify-end\">\n            <view class=\"cuIcon-close text-white text-xl margin-right margin-bottom\" @click=\"modelKefu = false\"></view>\n        </view>\n       <view class=\"drawer-modal-content bg-white padding \">\n            <view class=\"text-center margin-bottom\">\n                <view class=\"margin-top\">长按识别下方二维码</view>\n                <view>添加客服微信号，即可领取奖励</view>\n                <image class=\"margin-top\" src=\"../../static/kefu.png\" style=\"height: 400rpx;width: 400rpx;\"></image>\n            </view>\n       </view>\n    </view>\n\n     <modal v-model=\"modelEx\" hide-footer hide-header bg-color=\"none\"  @onRefresh=\"handleRefresh\" >\n        <img :src=\"exCode || `../../static/hongbao.png`\" style=\"width: 100%;\" class=\"radius-xl\"/>\n        <view class=\"bg-white round padding-xs margin-top-xs \" style=\"\">长按分享图片给好友或者保存吧</view>\n     </modal>\n\n</page>\n\n</template>\n\n<script>\n    import Page from \"../component/page/page\";\n    import Modal from \"../component/modal\";\n    import { decodeParams } from \"../../utils/utils\"\n    import {\n        checkSignin,\n        getExtensionCode,\n        getExtensionUser,\n        getNotice,\n        getUserInfo,\n        Login,\n        signin\n    } from \"../../api/user\";\n    import cache from \"../../utils/cache\";\n    export default {\n        name: \"user\",\n        components: {Modal, Page},\n        data(){\n            return {\n                modelKefu:false,\n                unreadNoticeCount:0,\n                modelEx:false,\n                exinfo:{},\n                userInfo:{},\n                exCode:null,\n                signInfo:{\n                    signed:true\n                }\n            }\n        },\n\n       async onLoad(options){\n           console.log(`调试:获取到token`, options);\n            this.loadData();\n\n\n\n        },\n        created(options){\n            // console.log(`调试:create->options`, options)\n            this.loadData();\n        },\n        methods:{\n            async handleRefresh(){\n                console.log(`调试:触发刷新`,);\n                cache.del('exCode');\n                uni.showLoading({title:'获取中'});\n                await this.handleToEx()\n                uni.showToast({title:'刷新成功'});\n            },\n            async loadData(){\n                let token =  cache.get(\"token\");\n                // cache.set(\"token\",token);\n                uni.showLoading({\n                    title:'loading',\n                })\n                let tokens = cache.get(\"tokens\");\n                let xToken = cache.get(\"X-Token\");\n                if(xToken){\n                    try {\n                        let { access_token,openid } = tokens;\n                        this.userInfo  = await getUserInfo({access_token,token,openid});\n                        this.signInfo = await  checkSignin();\n                        console.log(`调试:获取到的签到信息`, this.signInfo);\n\n                        this.exinfo = await  getExtensionUser({page:1,size:5});\n                        // this.exinfo =exinfo\n                        // console.log(`调试:获取到推广用户信息`, exinfo)\n                        uni.hideLoading();\n\n                        let notice = await  getNotice({status:0});\n                        this.unreadNoticeCount = notice.list.length;\n                        console.log(`调试:获取到通知信息`, notice)\n\n                    }catch (e) {\n                        console.log(`调试:出错`, e);\n                        uni.hideLoading();\n                    }\n                }else{\n                    console.log(`调试:没有Xtoken 重新调用登录`);\n                    Login({token})\n                }\n\n            },\n            handleToRecharge(){\n                uni.navigateTo({\n                    url:'../recharge/recharge'\n                })\n            },\n            handleToRechargeRecord(){\n                uni.navigateTo({\n                    url:'../rechargeRecord/rechargeRecord'\n                })\n            },\n            handleToExRecord(){\n                uni.navigateTo({\n                    url:'../consumeRecord/consumeRecord'\n                })\n            },\n            handleToRankingList(){\n                uni.navigateTo({\n                    url:'../rankingList/rankingList'\n                })\n            },\n            async handleToEx(){\n                uni.showLoading({title:'获取中'});\n              let res = await getExtensionCode().catch(res=>{\n                  uni.hideLoading();\n              });\n              uni.hideLoading();\n              this.modelEx = true;\n              this.exCode =res;\n              return  true;\n            },\n            handleToMessage(){\n                // uni.showToast({title:'Developing...',icon:'none'});\n                // return 0;\n              uni.navigateTo({\n                  url:'./message'\n              })\n            },\n            async handleSign(){\n                 if(!this.signInfo.signed){\n                      try {\n                          uni.showLoading({title:'签到中'});\n                           let result = await  signin();\n                           uni.hideLoading();\n                           this.loadData();\n                           uni.showModal({\n                               title:'签到成功',\n                               content:`您已成功签到 粮票+${result.addCoin}`,\n                               showCancel:false\n                           });\n                           console.log(`调试:签到返回值`,result)\n                      }catch ({error}) {\n                          uni.hideLoading();\n                          uni.showToast({\n                              title:error.msg || '签到失败',\n                              icon:'none'\n                          })\n                      }\n                 }\n            }\n        }\n    }\n</script>\n\n<style scoped scoped>\n.header{\n    width: 100%;\n    height: 320rpx;\n    background-image: url(\"../../static/bg_head.png\");\n    background-size: 100% 100%;\n}\n    .bg-avatar{\n        width: 90%;\n        height: 230rpx;\n        background: white;\n        position: relative;\n        background-image: url(\"../../static/bg_info.png\");\n        background-size: 100% 100%;\n        top: 180rpx;\n        box-shadow: 1px 1px 3px #022b777d;\n        border-radius: 10px;\n\n    }\n    .bg-cash{\n        background-image: url(\"../../static/cash_yellow.png\");\n        background-size: 100% 100%;\n        width: 80rpx;\n        height: 45rpx;\n    }\n    .bg-cash-sm{\n        background-image: url(\"../../static/cash_yellow.png\");\n        background-size: 100% 100%;\n        width: 60rpx;\n        height: 35rpx;\n        display: inline-block;\n    }\n    .text-blance{\n        color: black;\n        font-weight: bold;\n        font-size: 60rpx;\n\n    }\n/*    底部抽屉*/\n    .drawer-modal{\n        /*background: white;*/\n        position:absolute;\n        z-index: 99;\n        bottom: 0px;\n        width: 100%;\n    }\n    .drawer-modal-mask{\n        background-color:rgba(0,0,0,0.7);\n        width: 100vw;\n        height: 100vh;\n        position: fixed;\n        z-index: 98;\n        top: 0;\n    }\n    .drawer-modal-content{\n        border-top-left-radius: 50rpx;\n        border-top-right-radius: 50rpx;\n    }\n</style>\n"],"sourceRoot":"src/pages/user"}]}