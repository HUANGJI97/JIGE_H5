{"remainingRequest":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-2!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js!/Users/lianfangti/Project/UNI-APP/JIGE/src/pages/login/login.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/src/pages/login/login.vue","mtime":1568253429642},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@vue/cli-plugin-babel/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/vue-loader/lib/index.js","mtime":499162500000},{"path":"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-scoped-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"/Users/lianfangti/Project/UNI-APP/JIGE/node_modules/@babel/runtime/regenerator\"));\n\nvar _user = require(\"../../api/user\");\n\nvar _utils = require(\"../../utils/utils\");\n\nvar _cache = _interopRequireDefault(require(\"../../utils/cache\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nvar _default = {\n  name: \"login\",\n  data: function data() {\n    return {\n      loading: false\n    };\n  },\n  onLoad: function () {\n    var _onLoad = _asyncToGenerator(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee() {\n      var tokens, query, token, code, state, res;\n      return _regenerator.default.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              tokens = _cache.default.get(\"tokens\");\n              query = (0, _utils.decodeParams)(window.location.href);\n              token = query.token, code = query.code, state = query.state;\n              console.log(\"\\u8C03\\u8BD5:\\u83B7\\u53D6\\u7F13\\u5B58\", tokens);\n\n              if (!_cache.default.get(\"X-Token\")) {\n                _context.next = 10;\n                break;\n              }\n\n              if (token) {\n                _cache.default.set(\"token\", token);\n              }\n\n              uni.reLaunch({\n                url: '../user/user'\n              });\n              return _context.abrupt(\"return\", 0);\n\n            case 10:\n              if (!code) {\n                _context.next = 20;\n                break;\n              }\n\n              _context.next = 13;\n              return (0, _user.getAccessToken)({\n                code: code,\n                token: state\n              });\n\n            case 13:\n              res = _context.sent;\n\n              _cache.default.set(\"token\", state);\n\n              uni.reLaunch({\n                url: '../user/user'\n              });\n              console.log(\"\\u8C03\\u8BD5:\\u83B7\\u53D6\", res);\n              return _context.abrupt(\"return\", 0);\n\n            case 20:\n              if (token) {\n                console.log(\"\\u8C03\\u8BD5\\u4E0D\\u5B58\\u5728\\u7F13\\u5B58\\u6B63\\u5728\\u8C03\\u7528\\u767B\\u5F55:\");\n                (0, _user.Login)({\n                  token: token\n                });\n              } else {\n                token = 'wx21bd29efec1e0b44';\n                (0, _user.Login)({\n                  token: token\n                }); // console.log(`调试:啥都没有 程序结束`,query,tokens)\n              }\n\n            case 21:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    function onLoad() {\n      return _onLoad.apply(this, arguments);\n    }\n\n    return onLoad;\n  }(),\n  methods: {\n    handleLogin: function handleLogin() {\n      // Login()\n      uni.reLaunch({\n        url: '../index/index'\n      });\n    },\n    handleGetMobile: function () {\n      var _handleGetMobile = _asyncToGenerator(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee2(res) {\n        var detail, encryptedData, iv;\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                detail = res.detail;\n                encryptedData = detail.encryptedData, iv = detail.iv;\n                console.log(\"\\u8C03\\u8BD5:\\u83B7\\u53D6\\u624B\\u673A\\u53F7\\u8C03\\u8BD5\", encryptedData);\n                _context2.next = 5;\n                return (0, _user.getMobile)({\n                  encryptedData: encryptedData,\n                  iv: iv\n                });\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n\n      function handleGetMobile(_x) {\n        return _handleGetMobile.apply(this, arguments);\n      }\n\n      return handleGetMobile;\n    }(),\n    handelGetUserInfo: function () {\n      var _handelGetUserInfo = _asyncToGenerator(\n      /*#__PURE__*/\n      _regenerator.default.mark(function _callee3(res) {\n        var detail, userInfo, encryptedData, iv, token;\n        return _regenerator.default.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                detail = res.detail;\n                userInfo = detail.userInfo, encryptedData = detail.encryptedData, iv = detail.iv;\n                _context3.next = 4;\n                return (0, _user.Login)();\n\n              case 4:\n                token = _context3.sent;\n                this.loading = false;\n                uni.redirectTo({\n                  url: '../index/index'\n                });\n\n              case 7:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function handelGetUserInfo(_x2) {\n        return _handelGetUserInfo.apply(this, arguments);\n      }\n\n      return handelGetUserInfo;\n    }()\n  }\n};\nexports.default = _default;",{"version":3,"sources":["login.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n    <view class=\"cu-page   \">\n        <img src=\"../../static/haibao.jpg\" style=\"height: 100%;width: 100%;\">\n    </view>\n\n</template>\n\n<script>\n    import {getAccessToken, getMobile, Login} from \"../../api/user\";\n    import { decodeParams } from \"../../utils/utils\"\n    import cache from \"../../utils/cache\";\n\n\n    export default {\n        name: \"login\",\n        data() {\n            return {\n                loading: false\n            }\n        },\n        async onLoad(){\n            let tokens = cache.get(\"tokens\");\n            let query = decodeParams(window.location.href);\n            let {token,code,state,}  =query;\n\n\n            console.log(`调试:获取缓存`, tokens);\n\n            if(cache.get(\"X-Token\")){\n                if(token){\n                    cache.set(\"token\",token);\n                }\n                uni.reLaunch({\n                    url:'../user/user'\n                });\n                return 0;\n            }else if(code){\n                let res = await getAccessToken({code,token:state});\n                cache.set(\"token\",state);\n                uni.reLaunch({\n                    url:'../user/user'\n                });\n                console.log(`调试:获取`, res);\n                return 0;\n            }else if(token){\n                console.log(`调试不存在缓存正在调用登录:`);\n                Login({token});\n            }else{\n                token = 'wx21bd29efec1e0b44';\n                Login({token});\n                // console.log(`调试:啥都没有 程序结束`,query,tokens)\n            }\n\n            //\n            // if(code){\n            //\n            // }\n            // if(!query.token){\n            //     console.log(`调试:没有获取token程序结束`,query,window.location.href);\n            //     return\n            // }\n\n\n\n\n\n        },\n        methods: {\n            handleLogin() {\n                    // Login()\n                uni.reLaunch({\n                    url:'../index/index'\n                })\n            },\n            async handleGetMobile(res) {\n                let { detail } = res;\n                let {encryptedData,iv }= detail;\n                console.log(`调试:获取手机号调试`, encryptedData)\n                await  getMobile({encryptedData,iv });\n\n            },\n            async handelGetUserInfo(res) {\n                const { detail } = res;\n                const { userInfo,encryptedData,iv } = detail;\n                let token = await  Login();\n                this.loading = false\n                uni.redirectTo({\n                    url: '../index/index'\n                })\n\n            }\n        }\n    }\n</script>\n\n<style scoped scoped>\n    .bg-milk {\n        background-image: url(\"https://deepand.oss-cn-shenzhen.aliyuncs.com/image/bg-image-milk3.jpg\");\n        /*background-image:url(\"https://deepand.oss-cn-shenzhen.aliyuncs.com/image/bg-milk.jpg\") ;*/\n        /*background-image:url(\"https://deepand.oss-cn-shenzhen.aliyuncs.com/image/bg-image-milk.jpg\") ;*/\n        background-size: cover;\n        /*background-color: #f4f5f0;*/\n    }\n\n    .bg-cow {\n        background-image: url(\"https://deepand.oss-cn-shenzhen.aliyuncs.com/image/mow-huawen.jpeg\");\n        background-size: cover;\n        /*color: white;*/\n    }\n\n    .footer {\n        width: 70vw;\n        position: absolute;\n        left: 0px;\n        right: 0px;\n        bottom: 40px;\n        margin: 0 auto;\n        /*bottom: 0px;*/\n        /*left: 0px;*/\n        /*right: 0px;*/\n    }\n\n    /*https://deepand.oss-cn-shenzhen.aliyuncs.com/image/mow-huawen.jpeg*/\n</style>\n"],"sourceRoot":"src/pages/login"}]}